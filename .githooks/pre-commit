#!/usr/bin/env bash
# Prevent committing secret-bearing files (.env) or obvious API keys.

set -euo pipefail

# Block if .env is staged
if git diff --cached --name-only | grep -E '^\.env$' > /dev/null 2>&1; then
  echo "[pre-commit] ERROR: .env is staged. Remove it from the commit: git rm --cached .env" >&2
  exit 1
fi

# Scan staged diffs for OpenAI-style keys (sk- prefix)
if git diff --cached | grep -E 'sk-[A-Za-z0-9]{20,}' > /dev/null 2>&1; then
  echo "[pre-commit] ERROR: Potential OpenAI-style key detected in staged changes." >&2
  echo "Remove or redact the key before committing." >&2
  exit 1
fi

# Allow commit
exit 0
